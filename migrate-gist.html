<!DOCTYPE html>
<html>
<head>
    <title>Sync Gist with Seed Data</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #1a1a2e; color: #fff; max-width: 600px; margin: 0 auto; }
        h1 { color: #f39c12; }
        .status { background: #12121f; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .status.success { border-left: 4px solid #4caf50; }
        .status.error { border-left: 4px solid #f44336; }
        .status.pending { border-left: 4px solid #f39c12; }
        button { padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin: 10px 5px 10px 0; }
        button:hover { background: #764ba2; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .log { background: #0a0a14; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 13px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>Sync Gist with Seed Data</h1>
    <p>This will update your gist with the current seed file data (file paths for images).</p>

    <div id="auth-status" class="status pending">Checking login status...</div>

    <button id="migrate-btn" onclick="migrate()" disabled>Migrate All Checklists</button>

    <div class="log" id="log"></div>

    <script src="github-sync.js"></script>
    <script>
        const CHECKLISTS = [
            { id: 'jayden-daniels', file: 'seed/jayden-daniels.json' },
            { id: 'jmu-pro-players', file: 'seed/jmu-pro-players.json' },
            { id: 'washington-qbs', file: 'seed/washington-qbs.json' }
        ];

        const logEl = document.getElementById('log');
        const authStatus = document.getElementById('auth-status');
        const migrateBtn = document.getElementById('migrate-btn');

        function log(msg) {
            logEl.textContent += msg + '\n';
            logEl.scrollTop = logEl.scrollHeight;
        }

        async function init() {
            await githubSync.handleCallback();

            if (githubSync.isLoggedIn()) {
                const user = githubSync.getUser();
                authStatus.textContent = `Logged in as ${user.login}`;
                authStatus.className = 'status success';
                migrateBtn.disabled = false;
            } else {
                authStatus.innerHTML = 'Not logged in. <a href="#" onclick="githubSync.login(); return false;" style="color: #667eea;">Sign in with GitHub</a>';
                authStatus.className = 'status error';
            }
        }

        async function migrate() {
            migrateBtn.disabled = true;
            log('Starting migration...\n');

            for (const checklist of CHECKLISTS) {
                log(`Processing ${checklist.id}...`);

                try {
                    // Load seed data (has base64 images)
                    const response = await fetch(checklist.file);
                    const seedData = await response.json();

                    // Count images
                    let imageCount = 0;
                    const countImages = (obj) => {
                        if (Array.isArray(obj)) {
                            obj.forEach(item => countImages(item));
                        } else if (obj && typeof obj === 'object') {
                            if (obj.img) imageCount++;
                            Object.values(obj).forEach(val => countImages(val));
                        }
                    };
                    countImages(seedData);

                    log(`  Found ${imageCount} card images`);

                    // Save to gist
                    const success = await githubSync.saveCardData(checklist.id, seedData);

                    if (success) {
                        log(`  Saved to gist successfully\n`);
                    } else {
                        log(`  ERROR: Failed to save to gist\n`);
                    }
                } catch (e) {
                    log(`  ERROR: ${e.message}\n`);
                }
            }

            log('\nMigration complete!');
            log('Refresh your checklist pages to see the changes.');
        }

        init();
    </script>
</body>
</html>
