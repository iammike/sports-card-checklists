<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' https: data:; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://api.github.com https://cards-oauth.iammikec.workers.dev;">
    <title>JMU Pro Players Card Checklist</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="shared.css">
    <style>
        /* JMU Theme - Purple and Gold */
        :root {
            --color-primary: #450084;
            --color-primary-dark: #6b2fa0;
            --color-accent: #C9A227;
            --auth-bg: linear-gradient(135deg, #450084 0%, #2d0057 100%);
            --auth-link-color: #C9A227;
            --stat-bg: linear-gradient(135deg, #450084 0%, #2d0057 100%);
            --stat-value-color: #C9A227;
            --stat-label-color: #ccc;
            --card-hover-color: #450084;
            --nav-bg: linear-gradient(180deg, #350066 0%, #220044 100%);
        }

        /* Page header section */
        .page-header {
            background: linear-gradient(135deg, #450084 0%, #2d0057 100%);
            padding: 20px 20px 24px;
            margin-bottom: 24px;
            position: relative;
        }
        .page-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #C9A227, transparent);
        }

        .page-content {
            padding: 0 20px 20px;
        }

        h1 {
            background: linear-gradient(180deg, #d0d0d0 0%, #C9A227 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #888;
        }

        .stat {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.08);
        }
        .stat-value {
            color: #c8c8c8;
        }
        .stat-value.highlight {
            color: #C9A227;
        }

        .group-header {
            background: linear-gradient(135deg, #450084 0%, #2d0057 100%);
            border-bottom-color: #C9A227;
        }

        .card:hover {
            box-shadow: 0 4px 15px rgba(69,0,132,0.3);
        }

        .price-link:hover { color: #450084; }
        .card-image.placeholder:hover { color: #450084; }
        .search-link { color: #450084; }

        .read-only-notice {
            background: rgba(201,162,39,0.2);
            color: #C9A227;
        }

        /* Section header variants */
        .section-header.hof {
            background: linear-gradient(135deg, #C9A227 0%, #a88420 100%);
            color: #450084;
        }
        .section-header.usfl {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }
        .section-header.mlb {
            background: linear-gradient(135deg, #e74c3c 0%, #1a4789 100%);
        }
        .section-header.modern {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        /* Player name */
        .player-name {
            font-size: 14px;
            font-weight: bold;
            color: #450084;
            margin-bottom: 4px;
        }

        /* Achievement pills */
        .achievement {
            display: inline-block;
            background: rgba(201,162,39,0.2);
            color: #C9A227;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 6px;
            align-self: center;
        }

        /* Intro text (in dark header) */
        .intro-text {
            background: rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 4px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #aaa;
            line-height: 1.5;
            text-align: center;
        }
        .intro-text strong {
            color: #C9A227;
        }

        /* Extras/Alternates section */
        .alternates-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .alternates-header:hover {
            filter: brightness(1.1);
        }
        #alternates-toggle {
            transition: transform 0.2s;
        }
        #alternates-toggle.expanded {
            transform: rotate(90deg);
        }
        .extras-note {
            background: rgba(102, 102, 102, 0.15);
            color: #999;
            padding: 10px 15px;
            font-size: 12px;
            border-bottom: 1px solid rgba(102, 102, 102, 0.2);
        }
    </style>
</head>
<body>
    <nav class="nav-bar">
        <div class="nav-inner">
            <a href="index.html" class="nav-brand" title="All Checklists">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <rect x="3" y="3" width="8" height="11" rx="1" opacity="0.7"/>
                    <rect x="13" y="3" width="8" height="11" rx="1"/>
                    <rect x="3" y="16" width="18" height="5" rx="1" opacity="0.4"/>
                </svg>
                <span class="nav-brand-text">MIKE'S CARDS</span>
            </a>
            <div class="nav-divider"></div>
            <div class="nav-links">
                <a href="jayden-daniels-rookie-checklist.html" class="nav-link">JAYDEN DANIELS</a>
                <a href="jmu-pro-players-checklist.html" class="nav-link active">JMU PROS</a>
                <a href="washington-qbs-rookie-checklist.html" class="nav-link">WASHINGTON QBS</a>
            </div>
            <div class="nav-divider"></div>
            <div class="nav-auth">
                <span class="sync-status" id="sync-status"></span>
                <div id="auth-content"></div>
            </div>
        </div>
    </nav>

    <div class="page-header">
        <h1>JMU Pro Players Card Checklist</h1>
        <p class="subtitle">James Madison University Alumni in Professional Sports</p>

        <div class="intro-text">
            <strong>Go Dukes!</strong> This checklist features trading cards of James Madison University alumni who made it to the pros.
            Highlights include <strong>Hall of Famer Charles Haley</strong> (5x Super Bowl champion),
            <strong>Gary Clark</strong> (4x Pro Bowl, 2x Super Bowl), and <strong>Scott Norwood</strong> (famous for "Wide Right").
        </div>

        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="owned-count">0</div>
                <div class="stat-label">Owned</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="total-count">0</div>
                <div class="stat-label">Main Cards</div>
            </div>
            <div class="stat">
                <div class="stat-value highlight" id="total-value">$0</div>
                <div class="stat-label">Est. Value</div>
                <div class="stat-breakdown">
                    <span class="owned-value" id="owned-value">$0 owned</span>
                    <span class="needed-value" id="needed-value">$0 needed</span>
                </div>
            </div>
        </div>
    </div>

    <div class="page-content">
    <div class="filters">
        <select id="status-filter">
            <option value="all">All Cards</option>
            <option value="owned">Owned Only</option>
            <option value="need">Needed Only</option>
        </select>
        <select id="sport-filter">
            <option value="all">All Sports</option>
            <option value="football">Football Only</option>
            <option value="mlb">MLB Only</option>
            <option value="nba">NBA Only</option>
            <option value="mls">MLS Only</option>
        </select>
        <input type="text" id="search" placeholder="Search cards...">
    </div>

    <!-- Football (NFL + USFL) -->
    <div class="section" id="football-section">
        <div class="section-header">Football</div>
        <div class="card-grid" id="football-cards"></div>
    </div>

    <!-- MLB -->
    <div class="section" id="mlb-section">
        <div class="section-header mlb">MLB</div>
        <div class="card-grid" id="mlb-cards"></div>
    </div>

    <!-- NBA -->
    <div class="section" id="nba-section">
        <div class="section-header" style="background: linear-gradient(135deg, #1d428a 0%, #c9082a 100%);">NBA</div>
        <div class="card-grid" id="nba-cards"></div>
    </div>

    <!-- MLS -->
    <div class="section" id="mls-section">
        <div class="section-header" style="background: linear-gradient(135deg, #013a5e 0%, #5c9e31 100%);">MLS</div>
        <div class="card-grid" id="mls-cards"></div>
    </div>

    <!-- EXTRAS -->
    <div class="section" id="alternates-section" style="display: none;">
        <div class="section-header alternates-header" onclick="toggleAlternatesSection()" style="cursor: pointer; background: linear-gradient(135deg, #666 0%, #444 100%);">
            <span id="alternates-toggle" class="expanded">â–¼</span> Extra Cards <span id="alternates-count" style="font-weight: normal; font-size: 14px; opacity: 0.8;"></span>
        </div>
        <div class="extras-note">Alternate cards for players above. Not included in main checklist totals.</div>
        <div class="card-grid" id="alternates-cards"></div>
    </div>

    </div><!-- end page-content -->

    <script src="github-sync.js"></script>
    <script src="shared.js"></script>
    <script>
        // Card data loaded from external JSON file
        let cards = null;
        let checklistData = null;

        async function loadCardData() {
            // Try to load from gist first (gist is source of truth)
            if (window.githubSync?.isLoggedIn()) {
                const gistData = await githubSync.loadCardData('jmu-pro-players');
                if (gistData) {
                    checklistData = gistData;
                    cards = checklistData.categories;
                    return;
                }
            } else {
                // Not logged in - try public gist for latest data
                const publicData = await githubSync.loadPublicCardData('jmu-pro-players');
                if (publicData) {
                    checklistData = publicData;
                    cards = checklistData.categories;
                    return;
                }
            }

            // Fall back to seed data
            const response = await fetch('seed/jmu-pro-players.json');
            if (!response.ok) {
                throw new Error('Failed to load card data');
            }
            checklistData = await response.json();
            cards = checklistData.categories;

            // Save seed data to gist so it becomes the source of truth
            if (window.githubSync?.isLoggedIn()) {
                await githubSync.saveCardData('jmu-pro-players', checklistData);
            }
        }

        // Initialize checklist manager
        const checklistManager = new ChecklistManager({
            checklistId: 'jmu-pro-players',
            ownerUsername: 'iammike',
            localStorageKey: 'jmuProPlayersOwned',
            onOwnedChange: () => { renderCards(); updateStats(); },
            getStats: () => computeStats()
        });

        // Custom getCardId includes player name for JMU
        function getCardId(card) {
            return btoa(card.player + card.set + card.num + (card.variant || '')).replace(/[^a-zA-Z0-9]/g, '');
        }

        function isOwned(cardId) { return checklistManager.isOwned(cardId); }

        function toggleOwned(cardId, checkbox) {
            checklistManager.toggleOwned(cardId, checkbox.checked);
            // Re-render to handle alternate card swapping
            renderCards();
            applyFilters();
        }

        function applyFilters() {
            const statusFilter = document.getElementById('status-filter').value;
            const sportFilter = document.getElementById('sport-filter').value;
            const searchTerm = document.getElementById('search').value.toLowerCase();

            document.querySelectorAll('.card').forEach(c => {
                const owned = c.classList.contains('owned');
                const cardText = c.textContent.toLowerCase();
                const sport = c.dataset.sport;
                let show = true;
                if (statusFilter === 'owned' && !owned) show = false;
                if (statusFilter === 'need' && owned) show = false;
                if (sportFilter === 'football' && sport !== 'nfl' && sport !== 'usfl') show = false;
                else if (sportFilter !== 'all' && sportFilter !== 'football' && sport !== sportFilter) show = false;
                if (searchTerm && !cardText.includes(searchTerm)) show = false;
                c.style.display = show ? '' : 'none';
            });

            // Hide sections with no visible cards
            ['football', 'mlb', 'nba', 'mls'].forEach(section => {
                const sectionEl = document.getElementById(`${section}-section`);
                const cards = sectionEl.querySelectorAll('.card');
                const hasVisible = Array.from(cards).some(c => c.style.display !== 'none');
                sectionEl.style.display = hasVisible ? '' : 'none';
            });

            updateStats();
        }

        // Compute stats for saving (used by both updateStats and getStats callback)
        function computeStats() {
            const mainCards = document.querySelectorAll('.card:not([style*="display: none"]):not(#alternates-cards .card)');
            let ownedMain = 0, totalValue = 0, ownedValue = 0, neededValue = 0;
            mainCards.forEach(c => {
                const price = parseFloat(c.dataset.price);
                const owned = c.classList.contains('owned');
                totalValue += price;
                if (owned) {
                    ownedMain++;
                    ownedValue += price;
                } else {
                    neededValue += price;
                }
            });
            const allCards = [...(cards.NFL || []), ...(cards.USFL || []), ...(cards.MLB || []), ...(cards.NBA || []), ...(cards.MLS || [])];
            const alternates = allCards.filter(c => c.alternate);
            const ownedAlternates = alternates.filter(c => isOwned(getCardId(c))).length;

            return {
                owned: ownedMain,
                total: mainCards.length,
                ownedValue: Math.round(ownedValue),
                neededValue: Math.round(neededValue),
                extrasOwned: ownedAlternates,
                extrasTotal: alternates.length
            };
        }

        function updateStats() {
            const stats = computeStats();

            // Animate stats on first load
            StatsAnimator.animateStats({
                owned: { el: document.getElementById('owned-count'), value: stats.owned },
                total: { el: document.getElementById('total-count'), value: stats.total },
                totalValue: { el: document.getElementById('total-value'), value: stats.ownedValue + stats.neededValue },
                ownedValue: { el: document.getElementById('owned-value'), value: stats.ownedValue },
                neededValue: { el: document.getElementById('needed-value'), value: stats.neededValue }
            });
            // Stats are now saved atomically with owned cards via getStats callback
        }


        // JMU uses higher price thresholds
        const jmuPriceThresholds = { mid: 5, high: 15 };

        function createCardElement(card) {
            const cardId = getCardId(card);
            const owned = isOwned(cardId);
            const price = card.price;
            const searchUrl = CardRenderer.getEbayUrl(card.search);

            return `
                <div class="card ${owned ? 'owned' : ''}" data-price="${price}" data-sport="${card.sport}">
                    <div class="card-image-wrapper">
                        ${CardRenderer.renderAutoBadge(card)}
                        ${CardRenderer.renderPriceBadge(price, jmuPriceThresholds)}
                        ${CardRenderer.renderCardImage(card.img, card.set, searchUrl)}
                    </div>
                    <div class="player-name">${card.player}</div>
                    <div class="card-title">${card.set}</div>
                    <div class="card-number">${card.num} ${card.variant || ''}</div>
                    <div class="card-type">${card.type}</div>
                    ${CardRenderer.renderAchievements(card.badges)}
                    <div class="card-actions${checklistManager.isReadOnly && !owned ? ' links-only' : ''}">
                        ${CardRenderer.renderOwnedControl(cardId, owned, checklistManager.isReadOnly)}
                        ${CardRenderer.renderSearchLinks(searchUrl)}
                    </div>
                </div>
            `;
        }

        function toggleAlternatesSection() {
            const cardsEl = document.getElementById('alternates-cards');
            const toggleEl = document.getElementById('alternates-toggle');
            if (cardsEl.style.display === 'none') {
                cardsEl.style.display = '';
                toggleEl.classList.add('expanded');
            } else {
                cardsEl.style.display = 'none';
                toggleEl.classList.remove('expanded');
            }
        }

        // For players with alternates in the same sport, returns which card to show
        // (owned alternate if available, otherwise the primary)
        function getDisplayCard(playerCards) {
            const primaryCards = playerCards.filter(c => !c.alternate);
            const alternateCards = playerCards.filter(c => c.alternate);

            // Check if any alternate is owned
            const ownedAlternate = alternateCards.find(c => isOwned(getCardId(c)));
            if (ownedAlternate) {
                return ownedAlternate;
            }
            // Otherwise return the primary (or first card if no primary marked)
            return primaryCards[0] || playerCards[0];
        }

        function getYear(card) {
            const match = card.set.match(/\d{4}/);
            return match ? parseInt(match[0]) : 9999;
        }

        function renderCards() {
            // Combine all football cards (NFL + USFL) into one array
            const allFootballCards = [...(cards.NFL || []), ...(cards.USFL || [])];

            // Sport-based sections
            const sportSections = [
                { section: 'football', cards: allFootballCards },
                { section: 'mlb', cards: cards.MLB || [] },
                { section: 'nba', cards: cards.NBA || [] },
                { section: 'mls', cards: cards.MLS || [] },
            ];

            // Group cards by player AND sport to keep USFL/NFL cards separate
            const cardsByPlayerSport = {};
            sportSections.forEach(({cards: sectionCards}) => {
                sectionCards.forEach(card => {
                    const key = `${card.player}|${card.sport}`;
                    if (!cardsByPlayerSport[key]) {
                        cardsByPlayerSport[key] = [];
                    }
                    cardsByPlayerSport[key].push(card);
                });
            });

            // Determine which card should be displayed for each player+sport combo with alternates
            const displayCards = new Map();
            Object.entries(cardsByPlayerSport).forEach(([key, playerCards]) => {
                const hasAlternates = playerCards.some(c => c.alternate);
                if (hasAlternates) {
                    const displayCard = getDisplayCard(playerCards);
                    displayCards.set(displayCard, true);
                    // Mark all cards in this group for alternate handling
                    playerCards.forEach(c => {
                        if (c !== displayCard) {
                            displayCards.set(c, false); // false = should be hidden
                        }
                    });
                }
            });

            // Collect all alternate cards (that aren't the display card)
            const allAlternates = [];

            // Render each section, filtering out alternates (except display cards)
            sportSections.forEach(({section, cards: sectionCards}) => {
                const visibleCards = [];
                sectionCards.forEach(card => {
                    if (displayCards.has(card)) {
                        // This card is part of a group with alternates
                        if (displayCards.get(card) === true) {
                            visibleCards.push(card);
                        } else {
                            allAlternates.push(card);
                        }
                    } else {
                        // No alternates for this player+sport - show normally
                        visibleCards.push(card);
                    }
                });
                visibleCards.sort((a, b) => getYear(a) - getYear(b));
                document.getElementById(`${section}-cards`).innerHTML = visibleCards.map(createCardElement).join('');
            });

            // Render alternates section
            const alternatesSection = document.getElementById('alternates-section');
            const alternatesCount = document.getElementById('alternates-count');
            if (allAlternates.length > 0) {
                alternatesSection.style.display = '';
                alternatesCount.textContent = `(${allAlternates.length} cards)`;
                allAlternates.sort((a, b) => getYear(a) - getYear(b));
                document.getElementById('alternates-cards').innerHTML = allAlternates.map(createCardElement).join('');
            } else {
                alternatesSection.style.display = 'none';
            }

            updateStats();
        }

        document.getElementById('status-filter').addEventListener('change', applyFilters);
        document.getElementById('sport-filter').addEventListener('change', applyFilters);
        document.getElementById('search').addEventListener('input', applyFilters);

        // Initialize context menu for right-click editing
        const cardContextMenu = new CardContextMenu(checklistManager);

        // Save card data to GitHub repo
        async function saveCardDataToRepo() {
            checklistData.categories = cards;
            const success = await githubSync.saveCardData('jmu-pro-players', checklistData);
            if (success) {
                checklistManager.setSyncStatus('synced', 'Saved');
            } else {
                checklistManager.setSyncStatus('error', 'Save failed');
            }
            return success;
        }

        // Initialize card editor modal
        const cardEditor = new CardEditorModal({
            customFields: {
                player: { label: 'Player Name', type: 'text', fullWidth: true },
                variant: { label: 'Card Variant', type: 'text', placeholder: 'Rookie Card, Auto, etc.', fullWidth: true }
            },
            categories: [
                { value: 'NFL', label: 'NFL' },
                { value: 'USFL', label: 'USFL' },
                { value: 'MLB', label: 'MLB' },
                { value: 'NBA', label: 'NBA' },
                { value: 'MLS', label: 'MLS' }
            ],
            imageFolder: 'jmu-cards',
            onSave: async (cardId, cardData, isNew) => {
                if (isNew) {
                    // Add new card - category is now sport (NFL, MLB, etc.)
                    const category = cardData.category || 'NFL';
                    delete cardData.category;
                    // Map category to sport value
                    const sportMap = { NFL: 'nfl', USFL: 'usfl', MLB: 'mlb', NBA: 'nba', MLS: 'mls' };
                    const newCard = {
                        player: cardData.player || 'Unknown Player',
                        sport: sportMap[category] || 'nfl',
                        set: cardData.set,
                        num: cardData.num,
                        type: cardData.type
                    };
                    if (cardData.variant) newCard.variant = cardData.variant;
                    if (cardData.img) newCard.img = cardData.img;
                    if (cardData.price !== undefined) newCard.price = cardData.price;
                    if (cardData.auto) newCard.auto = true;
                    if (!cardData.ebay) {
                        newCard.search = `${newCard.player.replace(/\s+/g, '+')}+${newCard.set.replace(/\s+/g, '+')}`;
                    } else {
                        newCard.search = cardData.ebay;
                    }
                    if (cards[category]) {
                        insertCardSorted(cards[category], newCard);
                    }
                    console.log('Added new card:', newCard);
                } else {
                    // Update existing card
                    const found = findCardWithCategory(cardId);
                    if (found) {
                        const { card, category: oldCategory, index } = found;
                        const newCategory = cardData.category || oldCategory;
                        delete cardData.category;
                        // Map category to sport value
                        const sportMap = { NFL: 'nfl', USFL: 'usfl', MLB: 'mlb', NBA: 'nba', MLS: 'mls' };
                        if (cardData.player) card.player = cardData.player;
                        if (newCategory !== oldCategory) card.sport = sportMap[newCategory] || card.sport;
                        card.set = cardData.set;
                        card.num = cardData.num;
                        card.type = cardData.type;
                        // Handle optional fields - set if present, delete if cleared
                        if (cardData.variant) card.variant = cardData.variant;
                        else delete card.variant;
                        if ('price' in cardData) card.price = cardData.price;
                        else delete card.price;
                        if ('img' in cardData) card.img = cardData.img;
                        else delete card.img;
                        if ('auto' in cardData) card.auto = cardData.auto;
                        else delete card.auto;
                        if (cardData.ebay) card.search = cardData.ebay;
                        // Remove from old category
                        cards[oldCategory].splice(index, 1);
                        // Insert into (possibly new) category
                        insertCardSorted(cards[newCategory], card);
                        console.log('Updated card:', card, newCategory !== oldCategory ? `(moved to ${newCategory})` : '');
                    }
                }
                renderCards();
                // Save to GitHub repo
                checklistManager.setSyncStatus('syncing', 'Saving...');
                await saveCardDataToRepo();
            },
            onDelete: async (cardId) => {
                for (const category of Object.keys(cards)) {
                    const idx = cards[category].findIndex(c => getCardId(c) === cardId);
                    if (idx !== -1) {
                        cards[category].splice(idx, 1);
                        console.log('Deleted card:', cardId);
                        break;
                    }
                }
                renderCards();
                // Save to GitHub repo
                checklistManager.setSyncStatus('syncing', 'Saving...');
                await saveCardDataToRepo();
            }
        });

        // Helper to find card by ID
        function findCardById(cardId) {
            for (const category of Object.keys(cards)) {
                const card = cards[category].find(c => getCardId(c) === cardId);
                if (card) return card;
            }
            return null;
        }

        function findCardWithCategory(cardId) {
            for (const category of Object.keys(cards)) {
                const idx = cards[category].findIndex(c => getCardId(c) === cardId);
                if (idx !== -1) return { card: cards[category][idx], category, index: idx };
            }
            return null;
        }

        // Extract year from set name (e.g., "1987 Topps" -> 1987)
        function getSetYear(set) {
            const match = (set || '').match(/^\d{4}/);
            return match ? parseInt(match[0]) : 9999;
        }

        function insertCardSorted(arr, card) {
            const idx = arr.findIndex(c => {
                // Sort by year first
                const yearA = getSetYear(card.set);
                const yearB = getSetYear(c.set);
                if (yearB > yearA) return true;
                if (yearB < yearA) return false;
                // Then by player
                if (c.player > card.player) return true;
                if (c.player < card.player) return false;
                // Then by set name
                if (c.set > card.set) return true;
                if (c.set < card.set) return false;
                // Then by card number
                const numA = parseInt((card.num || '').replace(/\D/g, '')) || 0;
                const numB = parseInt((c.num || '').replace(/\D/g, '')) || 0;
                return numB > numA;
            });
            if (idx === -1) arr.push(card);
            else arr.splice(idx, 0, card);
        }

        // Wire up context menu callbacks
        cardContextMenu.onEdit = (cardId, cardElement) => {
            const found = findCardWithCategory(cardId);
            if (found) {
                cardEditor.open(cardId, { ...found.card, category: found.category });
            }
        };

        cardContextMenu.onDelete = async (cardId) => {
            for (const category of Object.keys(cards)) {
                const idx = cards[category].findIndex(c => getCardId(c) === cardId);
                if (idx !== -1) {
                    cards[category].splice(idx, 1);
                    break;
                }
            }
            renderCards();
            checklistManager.setSyncStatus('syncing', 'Saving...');
            await saveCardDataToRepo();
        };

        cardContextMenu.onAddCard = () => {
            cardEditor.openNew('NFL');
        };

        async function init() {
            try {
                await loadCardData();
                await checklistManager.init();
                cardContextMenu.init();
                cardEditor.init();
                renderCards();
            } catch (err) {
                console.error('Failed to initialize:', err);
                document.querySelector('.page-content').innerHTML =
                    '<p style="color:red;padding:20px;">Failed to load card data. Please refresh the page.</p>';
            }
        }
        init();
    </script>
</body>
</html>
